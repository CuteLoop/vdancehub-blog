{{ define "main" }}

  <!-- Portrait/landscape helpers for unified widths & readable type -->
  <style>
    /* Shared wrapper width for stacked (portrait) sections */
    .stacked-wrap { width: min(44rem, 92vw); margin-inline: auto; }

    /* Comfortable type in portrait so cards/descriptions stay readable */
    @media (max-aspect-ratio: 1/1) {
      html { font-size: 18px; }
      body { line-height: 1.65; }
    }

    /* Card grids */
    .cards-portrait { display: grid; gap: 1.5rem; }

    /* Portrait: 1 column by default; 2 on wider phones */
    @media (max-aspect-ratio: 1/1) {
      .cards-portrait { grid-template-columns: 1fr; }
    }
    @media (max-aspect-ratio: 1/1) and (min-width: 480px) {
      .cards-portrait { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    /* Landscape: 3 columns (desktop/tablets wide) */
    @media (min-aspect-ratio: 1/1) {
      .cards-portrait { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
  </style>

  {{/* 1) HERO: feature post or fallback square */}}
  {{ $featureTag := default "feature" site.Params.home.featureTag }}
  {{ $featured := first 1 (where .Site.RegularPages "Params.tags" "intersect" (slice $featureTag)) }}

  {{ if gt (len $featured) 0 }}
    {{ range $featured }}
      {{ partial "content/hero" . }}
    {{ end }}
  {{ else }}
    <!-- Fallback square -->
    <div class="stacked-wrap w-full flex justify-center py-12">
      <div class="w-16 h-16 bg-black"></div>
    </div>
  {{ end }}

  {{/* 2) Category section (use params.home.category; set "" to hide) */}}
  {{ $cat := site.Params.home.category }}
  {{ if $cat }}
  <section class="mb-16">
    <div class="stacked-wrap">
      <div class="flex items-center mb-6">
        <h2 class="text-3xl md:text-4xl font-bold mr-auto">{{ $cat | humanize }}</h2>
        <a class="hidden md:inline-block border rounded-full py-2 px-4 md:px-6 hover:bg-blue-100" href="{{ printf "/categories/%s" $cat | absURL }}">View All</a>
      </div>

      <div class="cards-portrait">
        {{ range where .Site.RegularPages "Params.categories" "intersect" (slice $cat) | first 6 }}
          {{ partial "content/card" . }}
        {{ end }}
      </div>

      <div class="md:hidden text-center mt-6">
        <a class="inline-block border rounded-full py-2 px-5 hover:bg-blue-100" href="{{ printf "/categories/%s" $cat | absURL }}">View All</a>
      </div>
    </div>
  </section>
  {{ end }}

  <div class="stacked-wrap"><hr class="my-8"></div>

  {{/* 3) Recent posts (uses mainSections from config) */}}
  {{ $paginator := .Paginate ( where site.RegularPages "Type" "in" site.Params.mainSections ) }}
  <section class="mb-16">
    <div class="stacked-wrap">
      <div class="flex items-center mb-6">
        <h2 class="text-3xl md:text-4xl font-bold mr-auto">Recent Posts</h2>
      </div>

      <div class="cards-portrait">
        {{ range $paginator.Pages }}
          {{ partial "content/card" . }}
        {{ end }}
      </div>
    </div>
  </section>

{{ end }}
