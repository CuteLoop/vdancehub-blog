{{ define "main" }}

  {{/* 1) HERO: feature post or fallback square */}}
  {{ $featureTag := default "feature" site.Params.home.featureTag }}
  {{ $featured := first 1 (where .Site.RegularPages "Params.tags" "intersect" (slice $featureTag)) }}

  {{ if gt (len $featured) 0 }}
    {{ range $featured }}
      {{ partial "content/hero" . }}
    {{ end }}
  {{ else }}
    <div class="w-full flex justify-center py-12">
      <div class="w-16 h-16 bg-black"></div>
    </div>
  {{ end }}

  {{/* 2) Category section (use params.home.category; set "" to hide) */}}
  {{ $cat := site.Params.home.category }}
  {{ if $cat }}
  <section class="mb-16">
    <div class="flex items-center mb-6">
      <h2 class="text-3xl md:text-4xl font-bold mr-auto">{{ $cat | humanize }}</h2>
      <a class="border rounded-full py-2 px-4 md:px-6 hover:bg-blue-100" href="{{ printf "/categories/%s" $cat | absURL }}">View All</a>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-10">
      {{ range where .Site.RegularPages "Params.categories" "intersect" (slice $cat) | first 3 }}
        {{ partial "content/card" . }}
      {{ end }}
    </div>
  </section>
  {{ end }}

  <hr class="my-8">

  {{/* 3) Recent posts (uses mainSections from config) */}}
  {{ $paginator := .Paginate ( where site.RegularPages "Type" "in" site.Params.mainSections ) }}
  <section class="mb-16">
    <div class="flex items-center mb-6">
      <h2 class="text-3xl md:text-4xl font-bold mr-auto">Recent Posts</h2>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-10">
      {{ range $paginator.Pages }}
        {{ partial "content/card" . }}
      {{ end }}
    </div>
  </section>

{{ end }}
